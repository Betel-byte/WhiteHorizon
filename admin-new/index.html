<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arctic Travel Admin - Content Management</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-form {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .admin-container {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .admin-nav h1 {
            color: #667eea;
            font-size: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: #f8f9fa;
            color: #333;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 0 2px;
        }

        .btn-edit { background: #28a745; color: white; }
        .btn-delete { background: #dc3545; color: white; }
        .btn-view { background: #17a2b8; color: white; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }

        .language-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .lang-tab {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            background: #f8f9fa;
        }

        .lang-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .language-content {
            display: none;
        }

        .language-content.active {
            display: block;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 8px;
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .gallery-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }

        .gallery-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .gallery-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
        }

        .itinerary-day {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .itinerary-day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div class="login-container" id="loginContainer">
        <div class="login-form">
            <h1><i class="fas fa-mountain"></i> Arctic Travel Admin</h1>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter password">
            </div>
            <button class="btn" onclick="handleLogin()">Login</button>
        </div>
    </div>

    <!-- Admin Container -->
    <div class="admin-container" id="adminContainer">
        <div class="admin-header">
            <div class="admin-nav">
                <h1><i class="fas fa-mountain"></i> Arctic Travel Admin</h1>
            </div>
            <button class="btn" onclick="handleLogout()">Logout</button>
        </div>

        <!-- Dashboard Stats -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-number" id="totalTrips">0</div>
                <div class="stat-label">Total Trips</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalDestinations">0</div>
                <div class="stat-label">Destinations</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalJournalPosts">0</div>
                <div class="stat-label">Journal Posts</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalTestimonials">0</div>
                <div class="stat-label">Testimonials</div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="admin-tabs">
            <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
            <button class="tab-btn" data-tab="trips">Trips</button>
            <button class="tab-btn" data-tab="destinations">Destinations</button>
            <button class="tab-btn" data-tab="journal">Journal</button>
            <button class="tab-btn" data-tab="testimonials">Testimonials</button>
            <button class="tab-btn" data-tab="settings">Site Settings</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div class="content-header">
                <h2>Dashboard Overview</h2>
            </div>
            <div id="dashboardContent">
                <p>Welcome to the Arctic Travel Content Management System. Use the tabs above to manage your content.</p>
            </div>
        </div>

        <!-- Trips Tab -->
        <div class="tab-content" id="trips">
            <div class="content-header">
                <h2>Manage Trips</h2>
                <button class="btn" onclick="openTripModal()">Add New Trip</button>
            </div>
            <div class="table-container">
                <table id="tripsTable">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Base Price</th>
                            <th>Duration</th>
                            <th>Featured</th>
                            <th>Departures</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tripsTableBody">
                    </tbody>
                </table>
                <div class="empty-state" id="tripsEmpty" style="display: none;">
                    <i class="fas fa-mountain"></i>
                    <h3>No trips found</h3>
                    <p>Add your first trip to get started</p>
                </div>
            </div>
        </div>

        <!-- Destinations Tab -->
        <div class="tab-content" id="destinations">
            <div class="content-header">
                <h2>Manage Destinations</h2>
                <button class="btn" onclick="openDestinationModal()">Add New Destination</button>
            </div>
            <div class="table-container">
                <table id="destinationsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Country</th>
                            <th>Best Time</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="destinationsTableBody">
                    </tbody>
                </table>
                <div class="empty-state" id="destinationsEmpty" style="display: none;">
                    <i class="fas fa-map-marker-alt"></i>
                    <h3>No destinations found</h3>
                    <p>Add your first destination to get started</p>
                </div>
            </div>
        </div>

        <!-- Journal Tab -->
        <div class="tab-content" id="journal">
            <div class="content-header">
                <h2>Manage Journal Posts</h2>
                <button class="btn" onclick="openJournalModal()">Add New Post</button>
            </div>
            <div class="table-container">
                <table id="journalTable">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Published</th>
                            <th>Featured</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="journalTableBody">
                    </tbody>
                </table>
                <div class="empty-state" id="journalEmpty" style="display: none;">
                    <i class="fas fa-newspaper"></i>
                    <h3>No journal posts found</h3>
                    <p>Add your first journal post to get started</p>
                </div>
            </div>
        </div>

        <!-- Testimonials Tab -->
        <div class="tab-content" id="testimonials">
            <div class="content-header">
                <h2>Manage Testimonials</h2>
                <button class="btn" onclick="openTestimonialModal()">Add New Testimonial</button>
            </div>
            <div class="table-container">
                <table id="testimonialsTable">
                    <thead>
                        <tr>
                            <th>Author</th>
                            <th>Quote</th>
                            <th>Rating</th>
                            <th>Approved</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="testimonialsTableBody">
                    </tbody>
                </table>
                <div class="empty-state" id="testimonialsEmpty" style="display: none;">
                    <i class="fas fa-quote-left"></i>
                    <h3>No testimonials found</h3>
                    <p>Add your first testimonial to get started</p>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="content-header">
                <h2>Site Settings</h2>
                <button class="btn" onclick="saveSiteSettings()">Save Settings</button>
            </div>
            <div id="settingsForm">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Site Title (English)</label>
                        <input type="text" id="siteTitleEn" placeholder="Enter site title">
                    </div>
                    <div class="form-group">
                        <label>Contact Email</label>
                        <input type="email" id="contactEmail" placeholder="Enter contact email">
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" id="phone" placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label>Logo</label>
                        <input type="file" id="logo" accept="image/*">
                        <img id="logoPreview" class="image-preview" style="display: none;">
                    </div>
                </div>
                <div class="form-group">
                    <label>Address (English)</label>
                    <textarea id="addressEn" rows="3" placeholder="Enter address"></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Trip Modal -->
    <div class="modal" id="tripModal">
        <div class="modal-content">
            <span class="close" onclick="closeTripModal()">&times;</span>
            <h2 id="tripModalTitle">Add New Trip</h2>
            <form id="tripForm">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Title (English) *</label>
                        <input type="text" id="tripTitleEn" required>
                    </div>
                    <div class="form-group">
                        <label>Price (USD) *</label>
                        <input type="number" id="tripPrice" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Duration *</label>
                        <input type="text" id="tripDuration" placeholder="e.g., 12 Days" required>
                    </div>
                    <div class="form-group">
                        <label>Max Group Size</label>
                        <input type="number" id="tripMaxGroupSize" min="1">
                    </div>
                </div>
                <div class="form-group">
                    <label>Summary (English)</label>
                    <textarea id="tripSummaryEn" rows="3"></textarea>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Featured Image *</label>
                        <input type="file" id="tripFeaturedImage" accept="image/*" required>
                        <img id="tripFeaturedImagePreview" class="image-preview" style="display: none;">
                    </div>
                    <div class="form-group">
                        <label>Gallery Images</label>
                        <input type="file" id="tripGallery" accept="image/*" multiple>
                        <div id="tripGalleryPreview" class="image-gallery"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Featured on Homepage</label>
                    <input type="checkbox" id="tripIsFeatured">
                </div>
                <div class="form-group">
                    <label>Destinations</label>
                    <select id="tripDestinations" multiple></select>
                </div>
                <div class="form-group">
                    <label>Difficulty Level</label>
                    <select id="tripDifficulty">
                        <option value="easy">Easy</option>
                        <option value="moderate">Moderate</option>
                        <option value="challenging">Challenging</option>
                        <option value="expert">Expert</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Overview (English)</label>
                    <textarea id="tripOverviewEn" rows="5"></textarea>
                </div>
                <div class="form-group">
                    <label>Included/Excluded (English)</label>
                    <textarea id="tripIncludedEn" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Itinerary</label>
                    <div id="tripItinerary"></div>
                    <button type="button" class="btn" onclick="addItineraryDay()">Add Day</button>
                </div>
                <div class="form-group">
                    <label>Manage Upcoming Departures</label>
                    <div id="departures-container">
                        <!-- Departure items will be added here -->
                    </div>
                    <button type="button" class="btn" onclick="addDeparture()">Add Departure</button>
                </div>
                <button type="submit" class="btn">Save Trip</button>
            </form>
        </div>
    </div>

    <!-- Destination Modal -->
    <div class="modal" id="destinationModal">
        <div class="modal-content">
            <span class="close" onclick="closeDestinationModal()">&times;</span>
            <h2 id="destinationModalTitle">Add New Destination</h2>
            <form id="destinationForm">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Name (English) *</label>
                        <input type="text" id="destinationNameEn" required>
                    </div>
                    <div class="form-group">
                        <label>Country</label>
                        <input type="text" id="destinationCountry" placeholder="e.g., Norway">
                    </div>
                    <div class="form-group">
                        <label>Region</label>
                        <input type="text" id="destinationRegion" placeholder="e.g., Svalbard">
                    </div>
                    <div class="form-group">
                        <label>Best Time to Visit</label>
                        <input type="text" id="destinationBestTime" placeholder="e.g., May - September">
                    </div>
                </div>
                <div class="form-group">
                    <label>Hero Image</label>
                    <input type="file" id="destinationHeroImage" accept="image/*">
                    <img id="destinationHeroImagePreview" class="image-preview" style="display: none;">
                </div>
                <div class="form-group">
                    <label>Description (English)</label>
                    <textarea id="destinationDescriptionEn" rows="5"></textarea>
                </div>
                <button type="submit" class="btn">Save Destination</button>
            </form>
        </div>
    </div>

    <!-- Journal Modal -->
    <div class="modal" id="journalModal">
        <div class="modal-content">
            <span class="close" onclick="closeJournalModal()">&times;</span>
            <h2 id="journalModalTitle">Add New Journal Post</h2>
            <form id="journalForm">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Title (English) *</label>
                        <input type="text" id="journalTitleEn" required>
                    </div>
                    <div class="form-group">
                        <label>Author *</label>
                        <input type="text" id="journalAuthor" required>
                    </div>
                    <div class="form-group">
                        <label>Published Date *</label>
                        <input type="datetime-local" id="journalPublishedAt" required>
                    </div>
                    <div class="form-group">
                        <label>Featured Image</label>
                        <input type="file" id="journalFeaturedImage" accept="image/*">
                        <img id="journalFeaturedImagePreview" class="image-preview" style="display: none;">
                    </div>
                </div>
                <div class="form-group">
                    <label>Excerpt (English)</label>
                    <textarea id="journalExcerptEn" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Content (English)</label>
                    <textarea id="journalBodyEn" rows="10"></textarea>
                </div>
                <div class="form-group">
                    <label>Tags</label>
                    <input type="text" id="journalTags" placeholder="Enter tags separated by commas">
                </div>
                <div class="form-group">
                    <label>Featured Post</label>
                    <input type="checkbox" id="journalFeatured">
                </div>
                <button type="submit" class="btn">Save Post</button>
            </form>
        </div>
    </div>

    <!-- Testimonial Modal -->
    <div class="modal" id="testimonialModal">
        <div class="modal-content">
            <span class="close" onclick="closeTestimonialModal()">&times;</span>
            <h2 id="testimonialModalTitle">Add New Testimonial</h2>
            <form id="testimonialForm">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Author Name *</label>
                        <input type="text" id="testimonialAuthorName" required>
                    </div>
                    <div class="form-group">
                        <label>Rating</label>
                        <select id="testimonialRating">
                            <option value="5">5 Stars</option>
                            <option value="4">4 Stars</option>
                            <option value="3">3 Stars</option>
                            <option value="2">2 Stars</option>
                            <option value="1">1 Star</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="testimonialDate">
                    </div>
                    <div class="form-group">
                        <label>Author Image</label>
                        <input type="file" id="testimonialAuthorImage" accept="image/*">
                        <img id="testimonialAuthorImagePreview" class="image-preview" style="display: none;">
                    </div>
                </div>
                <div class="form-group">
                    <label>Quote (English) *</label>
                    <textarea id="testimonialQuoteEn" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Related Trip</label>
                    <select id="testimonialRelatedTrip">
                        <option value="">Select a trip (optional)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Approved</label>
                    <input type="checkbox" id="testimonialApproved">
                </div>
                <button type="submit" class="btn">Save Testimonial</button>
            </form>
        </div>
    </div>

    <script>
        let token = localStorage.getItem('adminToken');
        let currentTripId = null;
        let currentDestinationId = null;
        let currentJournalId = null;
        let currentTestimonialId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (token) {
                showAdminInterface();
                loadDashboard();
            }
        });

        // Authentication
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            fetch('/api/admin/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    token = data.token;
                    localStorage.setItem('adminToken', token);
                    showAdminInterface();
                    loadDashboard();
                } else {
                    alert('Invalid credentials');
                }
            })
            .catch(err => console.error('Login error:', err));
        }

        function handleLogout() {
            localStorage.removeItem('adminToken');
            token = null;
            location.reload();
        }

        function showAdminInterface() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
        }

        // Tab Navigation
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                const tab = this.dataset.tab;
                document.getElementById(tab).classList.add('active');
                
                // Load content for each tab
                switch(tab) {
                    case 'trips': loadTrips(); break;
                    case 'destinations': loadDestinations(); break;
                    case 'journal': loadJournalPosts(); break;
                    case 'testimonials': loadTestimonials(); break;
                    case 'settings': loadSiteSettings(); break;
                }
            });
        });

        // API Helper
        function apiRequest(endpoint, options = {}) {
            return fetch(endpoint, {
                ...options,
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json',
                    ...options.headers
                }
            });
        }

        // Dashboard
        function loadDashboard() {
            apiRequest('/api/admin/stats')
                .then(res => res.json())
                .then(stats => {
                    document.getElementById('totalTrips').textContent = stats.totalTrips;
                    document.getElementById('totalDestinations').textContent = stats.totalDestinations;
                    document.getElementById('totalJournalPosts').textContent = stats.totalJournalPosts;
                    document.getElementById('totalTestimonials').textContent = stats.totalTestimonials;
                })
                .catch(err => console.error('Error loading dashboard:', err));
        }

        // Trips Management
        function loadTrips() {
            apiRequest('/api/admin/trips')
                .then(res => res.json())
                .then(trips => {
                    const tbody = document.getElementById('tripsTableBody');
                    tbody.innerHTML = '';
                    
                    if (trips.length === 0) {
                        document.getElementById('tripsEmpty').style.display = 'block';
                        return;
                    }
                    
                    document.getElementById('tripsEmpty').style.display = 'none';
                    
                    trips.forEach(trip => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${trip.title?.en || 'N/A'}</td>
                            <td>$${trip.price}</td>
                            <td>${trip.duration}</td>
                            <td>${trip.isFeatured ? 'Yes' : 'No'}</td>
                            <td>
                                <button class="btn-small btn-edit" onclick="editTrip('${trip.id}')">Edit</button>
                                <button class="btn-small btn-delete" onclick="deleteTrip('${trip.id}')">Delete</button>
                            </td>
                        `;
                    });
                })
                .catch(err => console.error('Error loading trips:', err));
        }

        function openTripModal() {
            currentTripId = null;
            document.getElementById('tripModalTitle').textContent = 'Add New Trip';
            document.getElementById('tripForm').reset();
            document.getElementById('tripModal').style.display = 'block';
        }

        function closeTripModal() {
            document.getElementById('tripModal').style.display = 'none';
        }

        // Destinations Management
        function loadDestinations() {
            apiRequest('/api/admin/destinations')
                .then(res => res.json())
                .then(destinations => {
                    const tbody = document.getElementById('destinationsTableBody');
                    tbody.innerHTML = '';
                    
                    if (destinations.length === 0) {
                        document.getElementById('destinationsEmpty').style.display = 'block';
                        return;
                    }
                    
                    document.getElementById('destinationsEmpty').style.display = 'none';
                    
                    destinations.forEach(destination => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${destination.name?.en || 'N/A'}</td>
                            <td>${destination.location?.country || 'N/A'}</td>
                            <td>${destination.bestTimeToVisit || 'N/A'}</td>
                            <td>
                                <button class="btn-small btn-edit" onclick="editDestination('${destination.id}')">Edit</button>
                                <button class="btn-small btn-delete" onclick="deleteDestination('${destination.id}')">Delete</button>
                            </td>
                        `;
                    });
                })
                .catch(err => console.error('Error loading destinations:', err));
        }

        function openDestinationModal() {
            currentDestinationId = null;
            document.getElementById('destinationModalTitle').textContent = 'Add New Destination';
            document.getElementById('destinationForm').reset();
            document.getElementById('destinationModal').style.display = 'block';
        }

        function closeDestinationModal() {
            document.getElementById('destinationModal').style.display = 'none';
        }

        // Journal Posts Management
        function loadJournalPosts() {
            apiRequest('/api/admin/journal-posts')
                .then(res => res.json())
                .then(posts => {
                    const tbody = document.getElementById('journalTableBody');
                    tbody.innerHTML = '';
                    
                    if (posts.length === 0) {
                        document.getElementById('journalEmpty').style.display = 'block';
                        return;
                    }
                    
                    document.getElementById('journalEmpty').style.display = 'none';
                    
                    posts.forEach(post => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${post.title?.en || 'N/A'}</td>
                            <td>${post.author}</td>
                            <td>${new Date(post.publishedAt).toLocaleDateString()}</td>
                            <td>${post.featured ? 'Yes' : 'No'}</td>
                            <td>
                                <button class="btn-small btn-edit" onclick="editJournal('${post.id}')">Edit</button>
                                <button class="btn-small btn-delete" onclick="deleteJournal('${post.id}')">Delete</button>
                            </td>
                        `;
                    });
                })
                .catch(err => console.error('Error loading journal posts:', err));
        }

        function openJournalModal() {
            currentJournalId = null;
            document.getElementById('journalModalTitle').textContent = 'Add New Journal Post';
            document.getElementById('journalForm').reset();
            document.getElementById('journalPublishedAt').value = new Date().toISOString().slice(0, 16);
            document.getElementById('journalModal').style.display = 'block';
        }

        function closeJournalModal() {
            document.getElementById('journalModal').style.display = 'none';
        }

        // Testimonials Management
        function loadTestimonials() {
            apiRequest('/api/admin/testimonials')
                .then(res => res.json())
                .then(testimonials => {
                    const tbody = document.getElementById('testimonialsTableBody');
                    tbody.innerHTML = '';
                    
                    if (testimonials.length === 0) {
                        document.getElementById('testimonialsEmpty').style.display = 'block';
                        return;
                    }
                    
                    document.getElementById('testimonialsEmpty').style.display = 'none';
                    
                    testimonials.forEach(testimonial => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${testimonial.authorName}</td>
                            <td>${testimonial.quote?.en?.substring(0, 50) || 'N/A'}...</td>
                            <td>${testimonial.rating || 5} ⭐</td>
                            <td>${testimonial.approved ? 'Yes' : 'No'}</td>
                            <td>
                                <button class="btn-small btn-edit" onclick="editTestimonial('${testimonial.id}')">Edit</button>
                                <button class="btn-small btn-delete" onclick="deleteTestimonial('${testimonial.id}')">Delete</button>
                            </td>
                        `;
                    });
                })
                .catch(err => console.error('Error loading testimonials:', err));
        }

        function openTestimonialModal() {
            currentTestimonialId = null;
            document.getElementById('testimonialModalTitle').textContent = 'Add New Testimonial';
            document.getElementById('testimonialForm').reset();
            document.getElementById('testimonialDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('testimonialModal').style.display = 'block';
        }

        function closeTestimonialModal() {
            document.getElementById('testimonialModal').style.display = 'none';
        }

        // Site Settings
        function loadSiteSettings() {
            apiRequest('/api/admin/site-settings')
                .then(res => res.json())
                .then(settings => {
                    document.getElementById('siteTitleEn').value = settings.siteTitle?.en || '';
                    document.getElementById('contactEmail').value = settings.contactEmail || '';
                    document.getElementById('phone').value = settings.phone || '';
                    document.getElementById('addressEn').value = settings.address?.en || '';
                })
                .catch(err => console.error('Error loading site settings:', err));
        }

        function saveSiteSettings() {
            const settings = {
                siteTitle: { en: document.getElementById('siteTitleEn').value },
                contactEmail: document.getElementById('contactEmail').value,
                phone: document.getElementById('phone').value,
                address: { en: document.getElementById('addressEn').value }
            };

            apiRequest('/api/admin/site-settings', {
                method: 'PUT',
                body: JSON.stringify(settings)
            })
            .then(res => res.json())
            .then(() => {
                alert('Site settings saved successfully');
            })
            .catch(err => console.error('Error saving site settings:', err));
        }

        // Departure Management Functions
        function addDeparture(departure = null) {
            const container = document.getElementById('departures-container');
            const index = container.children.length;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'departure-item collapsible';
            itemDiv.innerHTML = `
                <div class="departure-header" onclick="toggleDeparture(this)">
                    <h4>${departure ? departure.startDate : 'New Departure'}</h4>
                    <span class="departure-status">${departure ? departure.status : 'Available'}</span>
                </div>
                <div class="departure-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Departure ID</label>
                            <input type="text" name="departureId" value="${departure?.departureId || ''}" placeholder="e.g., SVAL-2024-06">
                        </div>
                        <div class="form-group">
                            <label>Start Date *</label>
                            <input type="date" name="startDate" value="${departure?.startDate || ''}" required onchange="updateDepartureHeader(this)">
                        </div>
                        <div class="form-group">
                            <label>End Date *</label>
                            <input type="date" name="endDate" value="${departure?.endDate || ''}" required onchange="validateDepartureDates(this)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Status *</label>
                            <select name="status" onchange="updateDepartureStatus(this)">
                                <option value="Available" ${!departure || departure.status === 'Available' ? 'selected' : ''}>Available</option>
                                <option value="Sold Out" ${departure?.status === 'Sold Out' ? 'selected' : ''}>Sold Out</option>
                                <option value="Guaranteed to Run" ${departure?.status === 'Guaranteed to Run' ? 'selected' : ''}>Guaranteed to Run</option>
                                <option value="On Request" ${departure?.status === 'On Request' ? 'selected' : ''}>On Request</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Price Override (USD)</label>
                            <input type="number" name="price" value="${departure?.price || ''}" placeholder="Leave blank to use base price">
                        </div>
                        <div class="form-group">
                            <label>Spots Available</label>
                            <input type="number" name="availability" value="${departure?.availability || ''}" min="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea name="notes" rows="2" placeholder="Special notes for this departure">${departure?.notes || ''}</textarea>
                    </div>
                    <button type="button" class="btn btn-danger" onclick="this.parentElement.parentElement.remove()">Remove Departure</button>
                </div>
            `;
            
            container.appendChild(itemDiv);
        }

        function toggleDeparture(header) {
            const content = header.nextElementSibling;
            content.style.display = content.style.display === 'none' ? 'block' : 'none';
        }

        function updateDepartureHeader(input) {
            const header = input.closest('.departure-item').querySelector('.departure-header h4');
            header.textContent = input.value || 'New Departure';
        }

        function updateDepartureStatus(select) {
            const statusSpan = select.closest('.departure-item').querySelector('.departure-status');
            statusSpan.textContent = select.value;
            statusSpan.className = `departure-status status-${select.value.toLowerCase().replace(/\s+/g, '-')}`;
        }

        function validateDepartureDates(input) {
            const itemDiv = input.closest('.departure-item');
            const startDate = new Date(itemDiv.querySelector('input[name="startDate"]').value);
            const endDate = new Date(input.value);
            
            if (endDate <= startDate) {
                alert('End date must be after start date');
                input.value = '';
            }
        }

        // Update trip table to show departures count
        function loadTrips() {
            apiRequest('/api/admin/trips')
                .then(res => res.json())
                .then(trips => {
                    const tbody = document.getElementById('trips-table-body');
                    tbody.innerHTML = '';
                    
                    if (trips.length === 0) {
                        document.getElementById('tripsEmpty').style.display = 'block';
                        return;
                    }
                    
                    document.getElementById('tripsEmpty').style.display = 'none';
                    
                    trips.forEach(trip => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${trip.title?.en || 'N/A'}</td>
                            <td>$${trip.basePrice}</td>
                            <td>${trip.duration}</td>
                            <td>${trip.isFeatured ? 'Yes' : 'No'}</td>
                            <td>${trip.departures?.length || 0}</td>
                            <td>
                                <button class="btn-small btn-edit" onclick="editTrip('${trip.id}')">Edit</button>
                                <button class="btn-small btn-delete" onclick="deleteTrip('${trip.id}')">Delete</button>
                            </td>
                        `;
                    });
                })
                .catch(err => console.error('Error loading trips:', err));
        }

        // Form submissions and other functions would go here...
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>